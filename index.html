<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ ë³´ë¬¼ì°½ê³ </title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f97316">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¦</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¦</text></svg>">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
        }

        /* Background Gradient */
        .bg-gradient {
            min-height: 100vh;
            background: linear-gradient(135deg, #fef7ed 0%, #fefce8 100%);
            padding: 1rem;
        }

        /* Container */
        .container {
            max-width: 64rem;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #6b7280;
        }

        /* Search and Control Area */
        .controls {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .search-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: none;
            outline: none;
            color: #374151;
            font-size: 0.875rem;
        }

        .search-input::placeholder {
            color: #9ca3af;
        }

        .button-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: #ea580c;
            color: white;
        }

        .btn-primary:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #3b82f6;
            color: white;
        }

        .btn-secondary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-gray {
            background: #6b7280;
            color: white;
        }

        .btn-gray:hover {
            background: #4b5563;
        }

        .btn-small {
            padding: 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .btn-icon {
            padding: 0.25rem;
            border-radius: 0.25rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Category Colors */
        .category-level-1 { background: #dbeafe; border: 2px solid #93c5fd; color: #1e40af; }
        .category-level-2 { background: #dcfce7; border: 2px solid #86efac; color: #166534; }
        .category-level-3 { background: #f3e8ff; border: 2px solid #c084fc; color: #7c3aed; }
        .category-level-4 { background: #fff7ed; border: 2px solid #fdba74; color: #c2410c; }
        .category-level-5 { background: #fefce8; border: 2px solid #fde047; color: #a16207; }
        .category-level-6 { background: #e0e7ff; border: 2px solid #a5b4fc; color: #4338ca; }
        .category-level-7 { background: #fee2e2; border: 2px solid #fca5a5; color: #dc2626; }
        .category-level-8 { background: #f0fdfa; border: 2px solid #5eead4; color: #0f766e; }
        .category-level-9 { background: #fff7ed; border: 2px solid #fdba74; color: #c2410c; }
        .category-level-10 { background: #ecfeff; border: 2px solid #67e8f9; color: #0891b2; }

        /* Category Container */
        .category {
            margin-bottom: 0.5rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .category-header:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .category-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-right {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .category-name {
            font-weight: 500;
        }

        .item-count {
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.6);
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }

        /* Forms */
        .form-container {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
            border: 2px solid #fed7aa;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .form-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 4rem;
        }

        .form-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Items */
        .items-container {
            margin-top: 0.5rem;
        }

        .items-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
            background: none;
            border: none;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .items-toggle:hover {
            color: #1f2937;
        }

        .item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.25rem;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .item-content {
            flex: 1;
        }

        .item-title {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .item-url {
            font-size: 0.75rem;
            color: #2563eb;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.25rem;
        }

        .item-url:hover {
            text-decoration: underline;
        }

        .item-memo {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .modal {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 28rem;
            width: 100%;
            margin: 1rem;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .modal-content {
            color: #6b7280;
            margin-bottom: 1.5rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Warning */
        .warning {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: #fef3c7;
            border: 2px solid #f59e0b;
            color: #92400e;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Legend */
        .legend {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .legend-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 1rem;
            height: 1rem;
            border-radius: 0.125rem;
        }

        .legend-color-1 { background: #dbeafe; border: 1px solid #93c5fd; }
        .legend-color-2 { background: #dcfce7; border: 1px solid #86efac; }
        .legend-color-3 { background: #f3e8ff; border: 1px solid #c084fc; }
        .legend-color-4 { background: #fff7ed; border: 1px solid #fdba74; }
       
        .legend-note {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        /* Search Results */
        .search-results {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
        }

        .search-results-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e40af;
        }

        .search-results-text {
            font-weight: 500;
        }

        .search-results-count {
            font-size: 0.875rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 0;
            color: #6b7280;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #d1d5db;
        }

        /* Help Section */
        .help {
            margin-top: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .help-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .help-list {
            list-style: none;
            padding: 0;
        }

        .help-item {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bg-gradient {
                padding: 0.5rem;
            }
            
            .legend-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Current location info */
        .current-location {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
        }

        .current-location-text {
            font-size: 0.875rem;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="bg-gradient">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1 class="title">ğŸ“¦ ë³´ë¬¼ì°½ê³ </h1>
                <p class="subtitle">ì¤‘ìš”í•œ ìë£Œë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë¦¬í•˜ì„¸ìš”</p>
            </div>

            <!-- Controls -->
            <div class="controls">
                <!-- Search -->
                <div class="search-container">
                    <span style="font-size: 18px;">ğŸ”</span>
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input" 
                        placeholder="í´ë”ëª…, ìë£Œ ì œëª©, URL, ë©”ëª¨ì—ì„œ ê²€ìƒ‰..."
                    >
                    <button id="clearSearchBtn" class="btn-icon hidden" title="ê²€ìƒ‰ ì´ˆê¸°í™”">
                        <span style="font-size: 16px;">âŒ</span>
                    </button>
                </div>

                <!-- Buttons -->
<div class="button-group">
    <button id="addCategoryBtn" class="btn btn-primary">
        <span style="font-size: 20px;">+</span>
        <span>ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</span>
    </button>
    <button id="homeBtn" class="btn btn-secondary hidden">
        <span>ğŸ </span>
        <span>ì´ˆê¸° í™”ë©´</span>
    </button>
    <button id="resetBtn" class="btn btn-success">
    <span>ğŸ”„</span>
    <span>ì´ˆê¸°í™”ë©´</span>
</button>
</div>
            </div>

            <!-- Category Form -->
            <div id="categoryForm" class="form-container hidden">
                <h3 id="categoryFormTitle" class="form-title">ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
                <div class="form-group">
                    <input 
                        type="text" 
                        id="categoryNameInput" 
                        class="form-input" 
                        placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„ (10ì ì´ë‚´)"
                    >
                </div>
                <div class="form-actions">
                    <button id="saveCategoryBtn" class="btn btn-success">
                        <span style="font-size: 18px;">ğŸ’¾</span>
                    </button>
                    <button id="cancelCategoryBtn" class="btn btn-gray">
                        <span style="font-size: 18px;">âŒ</span>
                    </button>
                </div>
            </div>

            <!-- Warning -->
            <div id="duplicateWarning" class="warning hidden">
                âš ï¸ <span id="warningText"></span>
            </div>

            <!-- Item Form -->
            <div id="itemForm" class="form-container hidden">
                <h3 id="itemFormTitle" class="form-title">ìƒˆ ìë£Œ ì¶”ê°€</h3>
                <div id="currentLocation" class="current-location hidden">
                    <div class="current-location-text">
                        ğŸ“ í˜„ì¬ ìœ„ì¹˜: <span id="currentLocationPath"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì œëª©</label>
                    <input 
                        type="text" 
                        id="itemTitleInput" 
                        class="form-input" 
                        placeholder="ìë£Œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                        maxlength="20"
                    >
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input 
                        type="url" 
                        id="itemUrlInput" 
                        class="form-input" 
                        placeholder="https://example.com"
                    >
                </div>
                <div class="form-group">
                    <label class="form-label">ë©”ëª¨</label>
                    <textarea 
                        id="itemMemoInput" 
                        class="form-textarea" 
                        placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        rows="3"
                    ></textarea>
                </div>
                <div class="form-actions">
                    <button id="saveItemBtn" class="btn btn-success">
                        <span style="font-size: 18px;">ğŸ’¾</span>
                    </button>
                    <button id="cancelItemBtn" class="btn btn-gray">
                        <span style="font-size: 18px;">âŒ</span>
                    </button>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <h3 class="legend-title">ì¹´í…Œê³ ë¦¬ ë ˆë²¨ ìƒ‰ìƒ</h3>
                <div class="legend-grid">
                    <div class="legend-item">
                        <div class="legend-color legend-color-1"></div>
                        <span>1ì°¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-color-2"></div>
                        <span>2ì°¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-color-3"></div>
                        <span>3ì°¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-color-4"></div>
                        <span>4ì°¨</span>
                    </div>
                    
                </div>
            </div>

            <!-- Search Results Info -->
            <div id="searchResults" class="search-results hidden">
                <div class="search-results-header">
                    <span style="font-size: 16px;">ğŸ”</span>
                    <span class="search-results-text">ê²€ìƒ‰ ê²°ê³¼: "<span id="searchTermDisplay"></span>"</span>
                    <span class="search-results-count">(<span id="searchCount">0</span>ê°œ í´ë”)</span>
                </div>
            </div>

            <!-- Categories Container -->
            <div id="categoriesContainer">
                <!-- Categories will be rendered here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state hidden">
                <div class="empty-icon">ğŸ“</div>
                <p>ì•„ì§ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="font-size: 0.875rem;">ìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            </div>

            <!-- No Search Results -->
            <div id="noSearchResults" class="empty-state hidden">
                <div class="empty-icon">ğŸ”</div>
                <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="font-size: 0.875rem;">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</p>
            </div>

            <!-- Help -->
            <div class="help">
                <h3 class="help-title">ğŸ“‹ ì‚¬ìš©ë²•</h3>
                <ul class="help-list">
                    <li class="help-item">â€¢ ë©”ì¸ ì¹´í…Œê³ ë¦¬(1ì°¨)ë¶€í„° ì‹œì‘í•˜ì—¬ 4ì°¨ê¹Œì§€ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ ê° ë ˆë²¨ì€ ë‹¤ë¥¸ ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ + ë²„íŠ¼ìœ¼ë¡œ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ ğŸ“„ ë²„íŠ¼ìœ¼ë¡œ ê° í´ë”ì— ìë£Œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ ìë£ŒëŠ” ì œëª©, URL, ë©”ëª¨ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©° ëª¨ë‘ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ í´ë”ë¥¼ í¼ì¹˜ë©´ ì €ì¥ëœ ìë£Œë“¤ì„ ì œëª©ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ ìë£Œë‚˜ í´ë” ì‚­ì œ ì‹œ í™•ì¸ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ í™”ì‚´í‘œë¥¼ í´ë¦­í•˜ì—¬ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë‚˜ ìë£Œë¥¼ ì ‘ê±°ë‚˜ í¼ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li class="help-item">â€¢ ë¬¸ì˜ì‚¬í•­: fbi1588@hanmail.net </li>
                </ul>
        </div>

            <!-- Backup Section -->
            <div class="help" style="margin-top: 1rem;">
                <h3 class="help-title">ğŸ’¾ ë°ì´í„° ë°±ì—…</h3>
                <div style="display: flex; gap: 0.5rem; justify-content: center;">
                    <button id="exportBtn" class="btn btn-success">
                        <span>ğŸ’¾</span>
                        <span>ë°±ì—…</span>
                    </button>
                    <button id="importBtn" class="btn btn-secondary">
                        <span>ğŸ“</span>
                        <span>ë³µì›</span>
                    </button>
                </div>
                <p style="font-size: 0.75rem; color: #6b7280; text-align: center; margin-top: 0.5rem;">
                    ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…í•˜ì—¬ ì†Œì¤‘í•œ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ì„¸ìš”. í°ì—ì„œë§Œ ì ìš©ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>
<!-- Move/Copy Item Modal -->
    <div id="moveModal" class="modal-overlay hidden">
        <div class="modal">
            <h3 class="modal-title" id="moveModalTitle">ìë£Œ ì´ë™</h3>
            <div class="modal-content">
                <p>ì–´ëŠ í´ë”ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div id="folderList" style="max-height: 300px; overflow-y: auto; margin: 1rem 0;">
                    <!-- í´ë” ëª©ë¡ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                </div>
            </div>
            <div class="modal-actions">
                <button id="cancelMoveBtn" class="btn btn-gray">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay hidden">
        <div class="modal">
            <h3 class="modal-title">ì‚­ì œ í™•ì¸</h3>
            <div class="modal-content">
                <p>ì‚­ì œë¥¼ í•˜ë©´ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                "<span id="deleteItemName"></span>"ì„(ë¥¼) ê¼­ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>
            <div class="modal-actions">
                <button id="cancelDeleteBtn" class="btn btn-gray">ì·¨ì†Œ</button>
                <button id="confirmDeleteBtn" class="btn btn-danger">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let categories = [];
        let expandedCategories = new Set();
        let expandedItems = new Set();
        let isCreating = false;
        let editingId = null;
        let selectedParent = null;
        let addingItemTo = null;
        let editingItem = null;
        let searchTerm = '';
        let filteredCategories = [];
        let deleteConfirmData = null;

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const homeBtn = document.getElementById('homeBtn');
        const categoryForm = document.getElementById('categoryForm');
        const categoryFormTitle = document.getElementById('categoryFormTitle');
        const categoryNameInput = document.getElementById('categoryNameInput');
        const saveCategoryBtn = document.getElementById('saveCategoryBtn');
        const cancelCategoryBtn = document.getElementById('cancelCategoryBtn');
        const duplicateWarning = document.getElementById('duplicateWarning');
        const warningText = document.getElementById('warningText');
        const itemForm = document.getElementById('itemForm');
        const itemFormTitle = document.getElementById('itemFormTitle');
        const currentLocation = document.getElementById('currentLocation');
        const currentLocationPath = document.getElementById('currentLocationPath');
        const itemTitleInput = document.getElementById('itemTitleInput');
        const itemUrlInput = document.getElementById('itemUrlInput');
        const itemMemoInput = document.getElementById('itemMemoInput');
        const saveItemBtn = document.getElementById('saveItemBtn');
        const cancelItemBtn = document.getElementById('cancelItemBtn');
        const searchResults = document.getElementById('searchResults');
        const searchTermDisplay = document.getElementById('searchTermDisplay');
        const searchCount = document.getElementById('searchCount');
        const categoriesContainer = document.getElementById('categoriesContainer');
        const emptyState = document.getElementById('emptyState');
        const noSearchResults = document.getElementById('noSearchResults');
        const deleteModal = document.getElementById('deleteModal');
        const deleteItemName = document.getElementById('deleteItemName');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        // Utility Functions
        function generateId() {
            return Date.now().toString();
        }

        function getColorClassForLevel(level) {
            const colorMap = {
                1: 'category-level-1', 2: 'category-level-2', 3: 'category-level-3', 4: 'category-level-4',
                5: 'category-level-5', 6: 'category-level-6', 7: 'category-level-7', 8: 'category-level-8',
                9: 'category-level-9', 10: 'category-level-10'
            };
            return colorMap[((level - 1) % 10) + 1];
        }

        // Data Management
        function loadData() {
            try {
                const saved = localStorage.getItem('treasureBoxData');
                return saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem('treasureBoxData', JSON.stringify(categories));
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        function checkDuplicateName(newName, parentCategory = null) {
            const categoriesToCheck = parentCategory ? parentCategory.children : categories;
            return categoriesToCheck.some(cat => cat.name === newName);
        }

        function findCategoryById(id, categoryList = categories) {
            for (let category of categoryList) {
                if (category.id === id) {
                    return category;
                }
                if (category.children && category.children.length > 0) {
                    const found = findCategoryById(id, category.children);
                    if (found) return found;
                }
            }
            return null;
        }

        function findCategoryPath(targetId, categoryList = categories, path = []) {
            for (let category of categoryList) {
                const currentPath = [...path, category.name];
                if (category.id === targetId) {
                    return currentPath;
                }
                if (category.children && category.children.length > 0) {
                    const childPath = findCategoryPath(targetId, category.children, currentPath);
                    if (childPath) return childPath;
                }
            }
            return null;
        }

        // Search Functions
        function searchCategories(term) {
            if (!term.trim()) {
                filteredCategories = [];
                return;
            }

            const searchInCategory = (category) => {
                let hasMatch = false;
                let matchedItems = [];
                let matchedChildren = [];

                // ì¹´í…Œê³ ë¦¬ ì´ë¦„ì—ì„œ ê²€ìƒ‰
                const categoryMatch = category.name.toLowerCase().includes(term.toLowerCase());

                // ì•„ì´í…œì—ì„œ ê²€ìƒ‰
                if (category.items) {
                    matchedItems = category.items.filter(item => 
                        item.title.toLowerCase().includes(term.toLowerCase()) ||
                        (item.url && item.url.toLowerCase().includes(term.toLowerCase())) ||
                        (item.memo && item.memo.toLowerCase().includes(term.toLowerCase()))
                    );
                }

                // í•˜ìœ„ ì¹´í…Œê³ ë¦¬ì—ì„œ ê²€ìƒ‰
                if (category.children) {
                    category.children.forEach(child => {
                        const childResult = searchInCategory(child);
                        if (childResult) {
                            matchedChildren.push(childResult);
                        }
                    });
                }

                hasMatch = categoryMatch || matchedItems.length > 0 || matchedChildren.length > 0;

          if (hasMatch) {
    return {
        ...category,
        items: categoryMatch ? category.items : matchedItems,
        children: matchedChildren.length > 0 ? matchedChildren : (categoryMatch ? category.children : []),
        isSearchResult: true
    };
}

                return null;
            };

            const results = categories.map(category => searchInCategory(category)).filter(Boolean);
            filteredCategories = results;

            // ê²€ìƒ‰ëœ ê²°ê³¼ì™€ ê·¸ ë¶€ëª¨ë“¤ì„ ëª¨ë‘ í¼ì¹˜ê¸°
            const allExpanded = new Set(expandedCategories);
            const addAllIds = (cats) => {
                cats.forEach(cat => {
                    allExpanded.add(cat.id);
                    if (cat.children && cat.children.length > 0) {
                        addAllIds(cat.children);
                    }
                });
            };
            addAllIds(results);
            expandedCategories = allExpanded;
        }

        // Category Management
        function addCategory() {
            const name = categoryNameInput.value.trim();
            if (!name) return;

             // ê¸€ììˆ˜ ì œí•œ í™•ì¸
    if ([...name].length > 10) {
        showWarning('í´ë”ëª…ì€ 10ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
    }
            // ì¤‘ë³µ ì´ë¦„ í™•ì¸
            if (checkDuplicateName(name, selectedParent)) {
                showWarning('ê°™ì€ í´ë”ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í´ë”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            hideWarning();

            const newCategory = {
                id: generateId(),
                name: name,
                level: selectedParent ? selectedParent.level + 1 : 1,
                parentId: selectedParent ? selectedParent.id : null,
                children: [],
                items: []
            };

            if (selectedParent) {
                const updateCategories = (cats) => {
                    return cats.map(cat => {
                        if (cat.id === selectedParent.id) {
                            return { ...cat, children: [...cat.children, newCategory] };
                        }
                        if (cat.children.length > 0) {
                            return { ...cat, children: updateCategories(cat.children) };
                        }
                        return cat;
                    });
                };
                categories = updateCategories(categories);
            } else {
                categories = [...categories, newCategory];
            }

            saveData();
            hideCategoryForm();
            renderApp();
        }

        function deleteCategory(categoryId) {
            const deleteCategoryRecursive = (cats) => {
                return cats.filter(cat => cat.id !== categoryId)
                    .map(cat => ({
                        ...cat,
                        children: deleteCategoryRecursive(cat.children)
                    }));
            };
            categories = deleteCategoryRecursive(categories);
            saveData();
            renderApp();
        }

        function updateCategoryName(categoryId, newName) {
            const updateCategories = (cats) => {
                return cats.map(cat => {
                    if (cat.id === categoryId) {
                        return { ...cat, name: newName };
                    }
                    if (cat.children.length > 0) {
                        return { ...cat, children: updateCategories(cat.children) };
                    }
                    return cat;
                });
            };
            categories = updateCategories(categories);
            saveData();
            editingId = null;
            renderApp();
        }

        // Item Management
        function saveItem() {
            const title = (itemTitleInput.value || 'ì œëª© ì—†ìŒ').slice(0, 20);
            const url = itemUrlInput.value;
            const memo = itemMemoInput.value;

            if (!title.trim() && !url.trim() && !memo.trim()) {
                return;
            }

            const targetCategoryId = editingItem ? editingItem.categoryId : addingItemTo;
            const newItem = {
                id: editingItem ? editingItem.id : generateId(),
                title: title,
                url: url,
                memo: memo,
                createdAt: editingItem ? editingItem.createdAt : new Date().toISOString()
            };

            const updateCategories = (cats) => {
                return cats.map(cat => {
                    if (cat.id === targetCategoryId) {
                        const updatedItems = editingItem 
                            ? cat.items.map(item => item.id === editingItem.id ? newItem : item)
                            : [...cat.items, newItem];
                        return { ...cat, items: updatedItems };
                    }
                    if (cat.children.length > 0) {
                        return { ...cat, children: updateCategories(cat.children) };
                    }
                    return cat;
                });
            };

            categories = updateCategories(categories);
            saveData();
            hideItemForm();
            renderApp();
        }

        function deleteItem(itemId, categoryId) {
            const updateCategories = (cats) => {
                return cats.map(cat => {
                    if (cat.id === categoryId) {
                        return { ...cat, items: cat.items.filter(item => item.id !== itemId) };
                    }
                    if (cat.children.length > 0) {
                        return { ...cat, children: updateCategories(cat.children) };
                    }
                    return cat;
                });
            };
            categories = updateCategories(categories);
            saveData();
            renderApp();
        }

        // UI State Management
        function showCategoryForm(parent = null) {
    // 4ì°¨ í´ë”ì—ì„œ í•˜ìœ„ í´ë” ìƒì„± ì‹œë„í•  ë•Œ ì œí•œ
    if (parent && parent.level >= 4) {
        alert('ë” ì´ìƒ í´ë”ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë©”ì¸ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒˆë¡œ ë§Œë“œì„¸ìš”');
        return;
    }
    
    selectedParent = parent;
    isCreating = true;
    categoryFormTitle.textContent = parent ? `"${parent.name}" í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ì¶”ê°€` : 'ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€';
    categoryNameInput.value = '';
    categoryForm.classList.remove('hidden');
    categoryNameInput.focus();
}

        function hideCategoryForm() {
            isCreating = false;
            selectedParent = null;
            categoryForm.classList.add('hidden');
            hideWarning();
        }

        function showItemForm(categoryId, item = null) {
            addingItemTo = item ? null : categoryId;
            editingItem = item ? { ...item, categoryId } : null;
            
            itemFormTitle.textContent = item ? 'ìë£Œ ìˆ˜ì •' : 'ìƒˆ ìë£Œ ì¶”ê°€';
            itemTitleInput.value = item ? item.title : '';
            itemUrlInput.value = item ? item.url : '';
            itemMemoInput.value = item ? item.memo : '';
            
            // í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ
            const targetId = item ? item.categoryId || categoryId : categoryId;
            const path = findCategoryPath(targetId);
            if (path) {
                currentLocationPath.textContent = path.join(' > ');
                currentLocation.classList.remove('hidden');
            } else {
                currentLocation.classList.add('hidden');
            }
            
            itemForm.classList.remove('hidden');
            itemTitleInput.focus();
        }

        function hideItemForm() {
            addingItemTo = null;
            editingItem = null;
            itemForm.classList.add('hidden');
            currentLocation.classList.add('hidden');
        }

        function showWarning(message) {
            warningText.textContent = message;
            duplicateWarning.classList.remove('hidden');
        }

        function hideWarning() {
            duplicateWarning.classList.add('hidden');
        }

        function showDeleteModal(type, id, name, categoryId = null) {
            deleteConfirmData = { type, id, name, categoryId };
            deleteItemName.textContent = name;
            deleteModal.classList.remove('hidden');
        }

        function hideDeleteModal() {
            deleteConfirmData = null;
            deleteModal.classList.add('hidden');
        }

        function toggleCategory(categoryId) {
            if (expandedCategories.has(categoryId)) {
                expandedCategories.delete(categoryId);
            } else {
                expandedCategories.add(categoryId);
            }
            renderApp();
        }

        function toggleItems(categoryId) {
            if (expandedItems.has(categoryId)) {
                expandedItems.delete(categoryId);
            } else {
                expandedItems.add(categoryId);
            }
            renderApp();
        }

        // Rendering Functions
        function renderCategory(category, depth = 0) {
            const isExpanded = expandedCategories.has(category.id);
            const isItemsExpanded = expandedItems.has(category.id);
            const hasChildren = category.children && category.children.length > 0;
            const hasItems = category.items && category.items.length > 0;
            const colorClass = getColorClassForLevel(category.level);

            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category';
            categoryDiv.style.marginLeft = `${depth * 10}px`;

            categoryDiv.innerHTML = `
                <div class="category-header ${colorClass}">
                    <div class="category-left">
                        ${(hasChildren || hasItems) ? `
                            <button class="btn-icon" onclick="toggleCategory('${category.id}')" title="í¼ì¹˜ê¸°/ì ‘ê¸°">
                                <span style="font-size: 16px;">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                            </button>
                        ` : '<div style="width: 24px;"></div>'}
                        <span style="font-size: 18px;">ğŸ“</span>
                        ${editingId === category.id ? `
                            <input 
                                type="text" 
                                value="${category.name}" 
                                class="form-input" 
                                style="width: 200px; padding: 0.25rem 0.5rem; font-size: 0.875rem;"
                                onkeypress="if(event.key==='Enter') updateCategoryName('${category.id}', this.value)"
                                onblur="updateCategoryName('${category.id}', this.value)"
                                id="editInput${category.id}"
                            >
                            
                        ` : `
                            <span class="category-name">${category.name}</span>
                            ${hasItems ? `<span class="item-count">${category.items.length}ê°œ</span>` : ''}
                        `}
                    </div>
                    <div class="category-right">
                        ${editingId === category.id ? `
                            <button class="btn-icon" onclick="updateCategoryName('${category.id}', document.getElementById('editInput${category.id}').value)" title="í™•ì •">
                                <span style="font-size: 14px;">âœ…</span>
                            </button>
                        ` : `
                            <button class="btn-icon" onclick="showItemForm('${category.id}')" title="ìë£Œ ì¶”ê°€">
                                <span style="font-size: 14px;">ğŸ“„</span>
                            </button>
                            ${category.level < 4 ? `
    <button class="btn-icon" onclick="showCategoryForm(findCategoryById('${category.id}'))" title="ì„œë¸Œ ì¹´í…Œê³ ë¦¬ ì¶”ê°€">
        <span style="font-size: 14px;">+</span>
    </button>
` : ''}
                            <button class="btn-icon" onclick="editingId='${category.id}'; renderApp()" title="ì´ë¦„ ìˆ˜ì •">
                                <span style="font-size: 14px;">âœï¸</span>
                            </button>
                            <button class="btn-icon" onclick="moveCategoryUp('${category.id}')" title="ìœ„ë¡œ ì´ë™">
                                <span style="font-size: 14px;">â¬†ï¸</span>
                            </button>
                            <button class="btn-icon" onclick="moveCategoryDown('${category.id}')" title="ì•„ë˜ë¡œ ì´ë™">
                                <span style="font-size: 14px;">â¬‡ï¸</span>
                            </button>
                            <button class="btn-icon" onclick="showDeleteModal('category', '${category.id}', '${category.name}')" title="ì‚­ì œ" style="color: #dc2626;">
                                <span style="font-size: 14px;">ğŸ—‘ï¸</span>
                            </button>
                        `}
                    </div>
            `;

            if (isExpanded) {
                const expandedDiv = document.createElement('div');
                expandedDiv.style.marginTop = '0.5rem';

                // Items section
                if (hasItems) {
                    const itemsDiv = document.createElement('div');
                    itemsDiv.className = 'items-container';
                    itemsDiv.style.marginLeft = `10px`;
                    itemsDiv.style.marginBottom = '0.5rem';

                    itemsDiv.innerHTML = `
                        <button class="items-toggle" onclick="toggleItems('${category.id}')">
                            <span style="font-size: 14px;">${isItemsExpanded ? 'â–¼' : 'â–¶'}</span>
                            <span style="font-size: 14px;">ğŸ“„</span>
                            <span>ìë£Œ (${category.items.length}ê°œ)</span>
                        </button>
                    `;

                    if (isItemsExpanded) {
                        const itemsList = document.createElement('div');
                        itemsList.style.marginTop = '0.25rem';

                  category.items.forEach(item => {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'item';

                            // ê²€ìƒ‰ ì¤‘ì¼ ë•ŒëŠ” ì œëª©ë§Œ, ì•„ë‹ ë•ŒëŠ” ì „ì²´ ì •ë³´ í‘œì‹œ
                            if (searchTerm) {
                                itemDiv.innerHTML = `
                                    <div class="item-content" onclick='showItemForm("${category.id}", ${JSON.stringify({...item, categoryId: category.id}).replace(/"/g, "&quot;")})' style="cursor: pointer;">
                                        <div class="item-title" style="color: #2563eb; text-decoration: underline;">${item.title}</div>
                                    </div>
                                    <div class="item-actions">
                                        
                                        <button class="btn-icon" onclick='showMoveModal("${item.id}", "${category.id}", ${JSON.stringify(item.title)})' title="ì´ë™">
                                            <span style="font-size: 12px;">ğŸ“</span>
                                        </button>
                                        <button class="btn-icon" onclick='showCopyModal("${item.id}", "${category.id}", ${JSON.stringify(item.title)})' title="ë³µì‚¬">
                                            <span style="font-size: 12px;">ğŸ“‹</span>
                                        </button>
                                        <button class="btn-icon" onclick='showDeleteModal("item", "${item.id}", ${JSON.stringify(item.title)}, "${category.id}")' title="ì‚­ì œ" style="color: #dc2626;">
                                            <span style="font-size: 12px;">ğŸ—‘ï¸</span>
                                        </button>

                                    </div>
                                `;
                           } else {
                               itemDiv.innerHTML = `
                                    <div class="item-content">
                                        <div class="item-title">${item.title}</div>
                                        ${item.url ? `<div class="item-url" onclick="window.open('${item.url}', '_blank')" style="cursor: pointer; color: #2563eb; text-decoration: underline;">ğŸ”— ë§í¬ ì—´ê¸°</div>` : ''}
                                    </div>
                                  <div class="item-actions">
        <button class="btn-icon" onclick="showItemForm('${category.id}', ${JSON.stringify(item).replace(/"/g, '&quot;')})" title="ìˆ˜ì •">
            <span style="font-size: 12px;">âœï¸</span>
        </button>
        <button class="btn-icon" onclick='showMoveModal("${item.id}", "${category.id}", ${JSON.stringify(item.title)})' title="ì´ë™">
            <span style="font-size: 12px;">ğŸ“</span>
        </button>

        <button class="btn-icon" onclick='showCopyModal("${item.id}", "${category.id}", ${JSON.stringify(item.title)})' title="ë³µì‚¬">
            <span style="font-size: 12px;">ğŸ“‹</span>
        </button>
        <button class="btn-icon" onclick='showDeleteModal("item", "${item.id}", ${JSON.stringify(item.title)}, "${category.id}")' title="ì‚­ì œ" style="color: #dc2626;">
            <span style="font-size: 12px;">ğŸ—‘ï¸</span>
        </button>
    </div>
                                `;
                            }
                            itemsList.appendChild(itemDiv);
                        });

                        itemsDiv.appendChild(itemsList);
                    }

                    expandedDiv.appendChild(itemsDiv);
                }

                // Children categories
                if (hasChildren) {
                    const childrenDiv = document.createElement('div');
                    category.children.forEach(child => {
                        childrenDiv.appendChild(renderCategory(child, depth + 1));
                    });
                    expandedDiv.appendChild(childrenDiv);
                }

                categoryDiv.appendChild(expandedDiv);
            }

            // Auto-focus edit input
            if (editingId === category.id) {
                setTimeout(() => {
                    const editInput = document.getElementById(`editInput${category.id}`);
                    if (editInput) {
                        editInput.focus();
                        editInput.select();
                    }
                }, 0);
            }

            return categoryDiv;
        }

        function renderApp() {
            const container = categoriesContainer;
            container.innerHTML = '';

            const currentCategories = searchTerm ? filteredCategories : categories;
            
           // Show/hide search results info
if (searchTerm) {
    searchTermDisplay.textContent = searchTerm;
    searchCount.textContent = filteredCategories.length;
    searchResults.classList.remove('hidden');
    // homeBtn.classList.remove('hidden'); // ì´ ì¤„ì„ ì£¼ì„ì²˜ë¦¬í•´ì„œ íŒŒë€ìƒ‰ ë²„íŠ¼ ì•ˆë‚˜ì˜¤ê²Œ í•¨
} else {
    searchResults.classList.add('hidden');
    homeBtn.classList.add('hidden');
}

            // Show/hide empty states
            if (categories.length === 0) {
                emptyState.classList.remove('hidden');
                noSearchResults.classList.add('hidden');
            } else if (searchTerm && filteredCategories.length === 0) {
                emptyState.classList.add('hidden');
                noSearchResults.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                noSearchResults.classList.add('hidden');
                
                // Render categories
                currentCategories.forEach(category => {
                    container.appendChild(renderCategory(category));
                });
            }
        }

        // Event Listeners
        function initializeEventListeners() {
            // Search
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                searchCategories(searchTerm);
                
                if (searchTerm) {
                    clearSearchBtn.classList.remove('hidden');
                } else {
                    clearSearchBtn.classList.add('hidden');
                    filteredCategories = [];
                }
                
                renderApp();
            });

            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                searchTerm = '';
                filteredCategories = [];
                clearSearchBtn.classList.add('hidden');
                renderApp();
            });

            homeBtn.addEventListener('click', () => {
                searchInput.value = '';
                searchTerm = '';
                filteredCategories = [];
                clearSearchBtn.classList.add('hidden');
                expandedCategories.clear();
                expandedItems.clear();
                renderApp();
            });
            // ì´ˆê¸°í™”ë©´ ë²„íŠ¼
document.getElementById('resetBtn').addEventListener('click', () => {
    searchInput.value = '';
    searchTerm = '';
    filteredCategories = [];
    clearSearchBtn.classList.add('hidden');
    expandedCategories.clear();
    expandedItems.clear();
    renderApp();
});

            // Category form
            addCategoryBtn.addEventListener('click', () => showCategoryForm());
            saveCategoryBtn.addEventListener('click', addCategory);
            cancelCategoryBtn.addEventListener('click', hideCategoryForm);
            
            categoryNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addCategory();
            });

            categoryNameInput.addEventListener('input', () => {
                hideWarning();
            });

            // Item form
            saveItemBtn.addEventListener('click', saveItem);
            cancelItemBtn.addEventListener('click', hideItemForm);

            // Delete modal
            // Move modal events
            document.getElementById('cancelMoveBtn').addEventListener('click', hideMoveModal);
            document.getElementById('moveModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('moveModal')) {
                    hideMoveModal();
                }
            });

            // Modal background click
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) {
                    hideDeleteModal();
                }
            });
            cancelDeleteBtn.addEventListener('click', hideDeleteModal);
            confirmDeleteBtn.addEventListener('click', () => {
                if (deleteConfirmData) {
                    if (deleteConfirmData.type === 'category') {
                        deleteCategory(deleteConfirmData.id);
                    } else {
                        deleteItem(deleteConfirmData.id, deleteConfirmData.categoryId);
                    }
                }
                hideDeleteModal();
            });

            // ë°±ì—…/ë³µì› ë²„íŠ¼
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importData);
        }
// Move/Copy Functions
        let moveModalData = null;

        

        function renderFolderList() {
            const folderList = document.getElementById('folderList');
            folderList.innerHTML = '';

            const renderFolder = (category, depth = 0) => {
                const folderDiv = document.createElement('div');
                folderDiv.style.marginLeft = `${depth * 20}px`;
                folderDiv.style.padding = '0.5rem';
                folderDiv.style.border = '1px solid #e5e7eb';
                folderDiv.style.borderRadius = '0.25rem';
                folderDiv.style.margin = '0.25rem 0';
                folderDiv.style.cursor = 'pointer';
                const colorClass = getColorClassForLevel(category.level);
                folderDiv.className = colorClass;
                if (category.id === moveModalData.fromCategoryId) {
                    folderDiv.style.opacity = '0.5';
                }

                if (category.id === moveModalData.fromCategoryId) {
                    folderDiv.style.opacity = '0.5';
                    const indentBars = 'â”‚ '.repeat(Math.max(0, depth));
                    const levelPrefix = '';
                    folderDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-family: monospace; color: #888; font-size: 14px;">${indentBars}${levelPrefix}</span>
                            <span style="font-size: 18px;">ğŸ“</span>
                            <span style="font-weight: 500;">${category.name}</span>
                            <span style="font-size: 0.75rem; opacity: 0.7; font-weight: bold;">(${category.level}ì°¨)</span>
                            <span style="font-size: 0.75rem; opacity: 0.7; color: #dc2626;">(í˜„ì¬ ìœ„ì¹˜)</span>
                        </div>
                    `;
                } else {
                    const indentBars = 'â”‚ '.repeat(Math.max(0, depth));
                    const levelPrefix = '';
                    folderDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-family: monospace; color: #888; font-size: 14px;">${indentBars}${levelPrefix}</span>
                            <span style="font-size: 18px;">ğŸ“</span>
                            <span style="font-weight: 500;">${category.name}</span>
                            <span style="font-size: 0.75rem; opacity: 0.7; font-weight: bold;">(${category.level}ì°¨)</span>
                        </div>
                    `;
                    folderDiv.onclick = () => moveOrCopyItem(category.id, category.name);
                    folderDiv.onmouseover = () => folderDiv.style.background = '#f9fafb';
                    folderDiv.onmouseout = () => folderDiv.style.background = 'white';
                }
                
                folderList.appendChild(folderDiv);

                if (category.children) {
                    category.children.forEach(child => renderFolder(child, depth + 1));
                }
            };

            categories.forEach(category => renderFolder(category));
        }

        function moveOrCopyItem(toCategoryId, toCategoryName) {
            const { itemId, fromCategoryId, itemTitle, type } = moveModalData;
            
            // ì›ë³¸ ì•„ì´í…œ ì°¾ê¸°
            let sourceItem = null;
            const findItem = (cats) => {
                for (let cat of cats) {
                    const item = cat.items.find(item => item.id === itemId);
                    if (item) return item;
                    if (cat.children.length > 0) {
                        const childItem = findItem(cat.children);
                        if (childItem) return childItem;
                    }
                }
                return null;
            };
            sourceItem = findItem(categories);

            if (!sourceItem) return;

            // ëŒ€ìƒ í´ë”ì— ì•„ì´í…œ ì¶”ê°€
            const updateCategories = (cats) => {
                return cats.map(cat => {
                    if (cat.id === toCategoryId) {
                        const newItem = {
                            ...sourceItem,
                            id: type === 'copy' ? generateId() : sourceItem.id
                        };
                        return { ...cat, items: [...cat.items, newItem] };
                    }
                    if (cat.children.length > 0) {
                        return { ...cat, children: updateCategories(cat.children) };
                    }
                    return cat;
                });
            };

            categories = updateCategories(categories);

            // ì´ë™ì˜ ê²½ìš° ì›ë³¸ì—ì„œ ì œê±°
            if (type === 'move') {
                const removeFromSource = (cats) => {
                    return cats.map(cat => {
                        if (cat.id === fromCategoryId) {
                            return { ...cat, items: cat.items.filter(item => item.id !== itemId) };
                        }
                        if (cat.children.length > 0) {
                            return { ...cat, children: removeFromSource(cat.children) };
                        }
                        return cat;
                    });
                };
                categories = removeFromSource(categories);
            }

            saveData();
            document.getElementById('moveModal').classList.add('hidden');
            alert(`âœ… "${itemTitle}"ì„(ë¥¼) "${toCategoryName}" í´ë”ë¡œ ${type === 'move' ? 'ì´ë™' : 'ë³µì‚¬'}í–ˆìŠµë‹ˆë‹¤!`);
            renderApp();
        }

        function hideMoveModal() {
            moveModalData = null;
            document.getElementById('moveModal').classList.add('hidden');
        }

        function showMoveModal(itemId, fromCategoryId, itemTitle) {
            moveModalData = { itemId, fromCategoryId, itemTitle, type: 'move' };
            document.getElementById('moveModalTitle').textContent = 'ìë£Œ ì´ë™';
            document.querySelector('#moveModal .modal-content p').textContent = 'ì–´ëŠ í´ë”ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            renderFolderList();
            document.getElementById('moveModal').classList.remove('hidden');
        }

        function showCopyModal(itemId, fromCategoryId, itemTitle) {
            moveModalData = { itemId, fromCategoryId, itemTitle, type: 'copy' };
            document.getElementById('moveModalTitle').textContent = 'ìë£Œ ë³µì‚¬';
            document.querySelector('#moveModal .modal-content p').textContent = 'ì–´ëŠ í´ë”ë¡œ ë³µì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            renderFolderList();
            document.getElementById('moveModal').classList.remove('hidden');
        }

         // í´ë” ìœ„ì¹˜ ì´ë™ í•¨ìˆ˜ë“¤
        function moveCategoryUp(categoryId) {
            const category = findCategoryById(categoryId);
            if (!category) return;

            const parentCategories = category.parentId 
                ? findCategoryById(category.parentId).children 
                : categories;

            const index = parentCategories.findIndex(cat => cat.id === categoryId);
            if (index > 0) {
                // ë°°ì—´ì—ì„œ ìœ„ì¹˜ ë°”ê¾¸ê¸°
                [parentCategories[index], parentCategories[index - 1]] = 
                [parentCategories[index - 1], parentCategories[index]];
                
                saveData();
                renderApp();
            }
        }

        function moveCategoryDown(categoryId) {
            const category = findCategoryById(categoryId);
            if (!category) return;

            const parentCategories = category.parentId 
                ? findCategoryById(category.parentId).children 
                : categories;

            const index = parentCategories.findIndex(cat => cat.id === categoryId);
            if (index < parentCategories.length - 1) {
                // ë°°ì—´ì—ì„œ ìœ„ì¹˜ ë°”ê¾¸ê¸°
                [parentCategories[index], parentCategories[index + 1]] = 
                [parentCategories[index + 1], parentCategories[index]];
                
                saveData();
                renderApp();
            }
        }
        // ë°±ì—… í•¨ìˆ˜
        function exportData() {
            const data = {
                categories: categories,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ë³´ë¬¼ì°½ê³ _ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('âœ… ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë³µì› í•¨ìˆ˜
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.categories) {
                        if (confirm('âš ï¸ ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ êµì²´ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            categories = data.categories;
                            saveData();
                            renderApp();
                            alert('âœ… ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                        }
                    } else {
                        alert('âŒ ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('âŒ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }
            // Folder Selection Modal Functions
        function showFolderSelectionModal() {
            // í´ë” ì„ íƒ ëª¨ë‹¬ HTML ë™ì  ìƒì„±
            const modalHTML = `
                <div id="folderSelectionModal" class="modal-overlay">
                    <div class="modal">
                        <h3 class="modal-title">ğŸ“ ì €ì¥í•  í´ë” ì„ íƒ</h3>
                        <div class="modal-content">
                            <p>ğŸ¬ ê³µìœ ë°›ì€ ì˜ìƒì„ ì–´ëŠ í´ë”ì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                            <div id="folderSelectionList" style="max-height: 300px; overflow-y: auto; margin: 1rem 0;">
                                <!-- í´ë” ëª©ë¡ì´ ì—¬ê¸°ì— ë“¤ì–´ê° -->
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button onclick="closeFolderSelectionModal()" class="btn btn-gray">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ì„ bodyì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // í´ë” ëª©ë¡ ë Œë”ë§
            renderFolderSelectionList();
        }

        function renderFolderSelectionList() {
            const folderList = document.getElementById('folderSelectionList');
            folderList.innerHTML = '';

            const renderFolder = (category, depth = 0) => {
                const folderDiv = document.createElement('div');
                folderDiv.style.marginLeft = `${depth * 20}px`;
                folderDiv.style.padding = '0.75rem';
                folderDiv.style.border = '2px solid';
                folderDiv.style.borderRadius = '0.5rem';
                folderDiv.style.margin = '0.5rem 0';
                folderDiv.style.cursor = 'pointer';
                folderDiv.style.transition = 'all 0.2s';
                
                const colorClass = getColorClassForLevel(category.level);
                folderDiv.className = colorClass;
                
                // ë ˆë²¨ë³„ ë“¤ì—¬ì“°ê¸° ì‹œê°í™”
                const indentBars = 'â”‚ '.repeat(Math.max(0, depth));
                const levelPrefix = '';
                
                folderDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-family: monospace; color: #888; font-size: 14px;">${indentBars}${levelPrefix}</span>
                        <span style="font-size: 18px;">ğŸ“</span>
                        <span style="font-weight: 500;">${category.name}</span>
                        <span style="font-size: 0.75rem; opacity: 0.7; font-weight: bold;">(${category.level}ì°¨)</span>
                    </div>
                `;
                
                folderDiv.onclick = () => selectFolderAndSave(category.id, category.name);
                folderDiv.onmouseover = () => {
                    folderDiv.style.transform = 'scale(1.02)';
                    folderDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                };
                folderDiv.onmouseout = () => {
                    folderDiv.style.transform = 'scale(1)';
                    folderDiv.style.boxShadow = 'none';
                };
                
                folderList.appendChild(folderDiv);

                // í•˜ìœ„ í´ë”ë“¤ë„ í‘œì‹œ
                if (category.children && category.children.length > 0) {
                    category.children.forEach(child => renderFolder(child, depth + 1));
                }
            };

            categories.forEach(category => renderFolder(category));
        }

       function selectFolderAndSave(categoryId, categoryName) {
            // ê³µìœ  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const sharedData = window.sharedData;
            if (!sharedData) return;
            
           // ìƒˆ ì•„ì´í…œ ìƒì„±
            const newItem = {
                id: generateId(),
                title: (sharedData.title || 'ì œëª© ì—†ìŒ').slice(0, 20),
                url: sharedData.url || '',
                memo: sharedData.text || '',
                createdAt: new Date().toISOString()
            };

            // ì„ íƒëœ í´ë”ì— ì•„ì´í…œ ì¶”ê°€
            const updateCategories = (cats) => {
                return cats.map(cat => {
                    if (cat.id === categoryId) {
                        return { ...cat, items: [...cat.items, newItem] };
                    }
                    if (cat.children.length > 0) {
                        return { ...cat, children: updateCategories(cat.children) };
                    }
                    return cat;
                });
            };

            categories = updateCategories(categories);
            saveData();
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeFolderSelectionModal();
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert(`âœ… "${newItem.title}"ì´(ê°€) "${categoryName}" í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            renderApp();
            
            // ê³µìœ  ë°ì´í„° ì •ë¦¬
            delete window.sharedData;
        }

        function closeFolderSelectionModal() {
            const modal = document.getElementById('folderSelectionModal');
            if (modal) {
                modal.remove();
            }
            // ê³µìœ  ë°ì´í„° ì •ë¦¬
            delete window.sharedData;
        }
        // Initialize App
        function initializeApp() {
            categories = loadData();
            initializeEventListeners();
            renderApp();

            // Service Worker registration
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.log('Service Worker registered successfully:', registration.scope);
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            }

            // Handle shared data
            window.addEventListener('load', () => {
                const urlParams = new URLSearchParams(window.location.search);
                const sharedTitle = urlParams.get('title');
                const sharedText = urlParams.get('text');
                const sharedUrl = urlParams.get('url');
                
              if (sharedTitle || sharedText || sharedUrl) {
                    console.log('ê³µìœ ëœ ë°ì´í„°:', {
                        title: sharedTitle,
                        text: sharedText,
                        url: sharedUrl
                    });
                    
                    // ê³µìœ ëœ ë°ì´í„°ë¡œ í´ë” ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
                    if (categories.length > 0) {
                        // ê³µìœ ëœ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                        window.sharedData = {
                            title: sharedTitle,
                            url: sharedUrl,
                            text: sharedText
                        };
                        
                        // í´ë” ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
                        showFolderSelectionModal();
                    } else {
                        alert('ğŸ“ ë¨¼ì € ì¹´í…Œê³ ë¦¬ë¥¼ ë§Œë“  í›„ ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”!');
                    }
                }
            });
        }


    
        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
        window.showDeleteModal = showDeleteModal;
        window.showMoveModal = showMoveModal;
        window.showCopyModal = showCopyModal;
        window.hideMoveModal = hideMoveModal;
        window.moveOrCopyItem = moveOrCopyItem;
        window.findCategoryById = findCategoryById;
        window.toggleCategory = toggleCategory;
        window.toggleItems = toggleItems;
        window.showCategoryForm = showCategoryForm;
        window.showItemForm = showItemForm;
        window.moveCategoryUp = moveCategoryUp;
        window.moveCategoryDown = moveCategoryDown;
        window.updateCategoryName = updateCategoryName;

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
    <input type="file" id="importFile" accept=".json" style="display: none;">
</body>
</html>
